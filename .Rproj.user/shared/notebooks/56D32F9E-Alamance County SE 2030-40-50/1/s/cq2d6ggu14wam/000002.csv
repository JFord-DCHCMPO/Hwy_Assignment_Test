"0","CAGR_formula <- function(PV, FV, yrs) {"
"0","    values <- ((FV/PV)^(1/yrs)-1)"
"0","    return(values)"
"0","}"
"0",""
"0",""
"0",""
"0","## change to Pop growth too"
"0","triad_total <- triad_total %>% "
"0","  mutate(CAGR_HH = CAGR_formula(HH_2017, HH_2045, 28),"
"0","         CAGR_Pop = CAGR_formula(HH_POP_2017, HH_POP_2045, 28),"
"0","         CAGR_Retail = CAGR_formula(Retail_2017, Retail_2045, 28),"
"0","         CAGR_Office= CAGR_formula(Office_2017, Office_2045, 28),"
"0","         CAGR_Service= CAGR_formula(Service_2017, Service_2045, 28),"
"0","         CAGR_Industry= CAGR_formula(Industry_2017, Industry_2045, 28),"
"0","         HH_2050 = HH_2017 * (1 + CAGR_HH) ^ 33,"
"0","         HH_2040 = HH_2017 * (1 + CAGR_HH) ^ 23,"
"0","         HH_2030 = HH_2017 * (1 + CAGR_HH) ^ 13,"
"0","         POP_2050 = HH_POP_2017 * (1 + CAGR_Pop) ^ 33,"
"0","         POP_2040 = HH_POP_2017 * (1 + CAGR_Pop) ^ 23,"
"0","         POP_2030 = HH_POP_2017 * (1 + CAGR_Pop) ^ 13,"
"0","         "
"0","         ) %>%"
"0","  select(Triad_ID=ID, CAGR_HH, CAGR_Pop, CAGR_Retail, CAGR_Office, CAGR_Service, CAGR_Industry) %>%"
"0","  st_drop_geometry()"
"0",""
"0",""
"0",""
"0","tag_tazs <- tazs %>%"
"0","  filter(COUNTY == ""Alamance"") %>%"
"0","  st_point_on_surface() %>%"
"0","  st_join(triad_tazs %>% select(Triad_ID = ID))%>%"
"0","  st_drop_geometry()"
"0",""
"0","final_join <- merge(tag_tazs, triad_total) %>%"
"0","  select(ID, CAGR_HH, CAGR_Pop, CAGR_Retail, CAGR_Office, CAGR_Service, CAGR_Industry)"
"0",""
"0",""
"0","final_se_alamance <- merge(final_join, se_2020, by.x=""ID"", by.y=""TAZ"") %>%"
"0","  mutate(Service = Service_RateHigh + Service_RateLow) %>%"
"0","  mutate("
"0","    total_retail_growth = case_when("
"0","      is.nan(CAGR_Retail) & Retail > 0 ~ mean(CAGR_Retail, na.rm=T), "
"0","      TRUE ~ 0),"
"0","    "
"0","    total_service_low_growth = case_when("
"0","      is.nan(CAGR_Service) & Service_RateLow > 0 ~ mean(CAGR_Service, na.rm=T), "
"0","      TRUE ~ 0),"
"0","    "
"0","    total_service_hi_growth = case_when("
"0","      is.nan(CAGR_Service) & Service_RateHigh > 0 ~ mean(CAGR_Service, na.rm=T), "
"0","      TRUE ~ 0),"
"0","    "
"0","    total_industry_growth = case_when("
"0","      is.nan(CAGR_Industry) & Industry > 0 ~ mean(CAGR_Industry, na.rm=T), "
"0","      TRUE ~ 0),"
"0","    "
"0","    total_office_growth = case_when("
"0","      is.nan(CAGR_Office) & Office>0 ~ mean(CAGR_Office, na.rm=T), "
"0","      TRUE ~ 0)"
"0","    ) %>%"
"0","  "
"0","  mutate(HH_2030 = HH * (1+CAGR_HH)^10,"
"0","         HH_2040 = HH * (1+CAGR_HH)^20,"
"0","         HH_2050 = HH * (1+CAGR_HH)^30,"
"0","         "
"0","         HH_POP_2030 = HH_POP * (1+CAGR_Pop)^10,"
"0","         HH_POP_2040 = HH_POP * (1+CAGR_Pop)^20,"
"0","         HH_POP_2050 = HH_POP * (1+CAGR_Pop)^30,"
"0","         "
"0","         Retail_2030 = ifelse(total_retail_growth > 0, Retail * (1+total_retail_growth)^10,Retail * ( 1 + CAGR_Retail)^10),"
"0","         Retail_2040 = ifelse(total_retail_growth > 0, Retail * (1+total_retail_growth)^20,Retail * ( 1 + CAGR_Retail)^20),"
"0","         Retail_2050 = ifelse(total_retail_growth > 0, Retail * (1+total_retail_growth)^30,Retail * ( 1 + CAGR_Retail)^30),"
"0","           "
"0","         Service_RateLow2030 = ifelse(total_service_low_growth > 0, Service_RateLow * (1+total_service_low_growth)^10,Service_RateLow * ( 1 + CAGR_Service)^10),"
"0","         Service_RateLow2040= ifelse(total_service_low_growth > 0, Service_RateLow * (1+total_service_low_growth)^20,Service_RateLow * ( 1 + CAGR_Service)^20),"
"0","         Service_RateLow2050= ifelse(total_service_low_growth > 0, Service_RateLow * (1+total_service_low_growth)^30,Service_RateLow * ( 1 + CAGR_Service)^30),"
"0","         "
"0","         Service_RateHigh2030 = ifelse(total_service_hi_growth > 0, Service_RateHigh * (1+total_service_hi_growth)^10,Service_RateHigh * ( 1 + CAGR_Service)^10),"
"0","         Service_RateHigh2040= ifelse(total_service_hi_growth > 0, Service_RateHigh * (1+total_service_hi_growth)^20,Service_RateHigh * ( 1 + CAGR_Service)^20),"
"0","         Service_RateHigh2050= ifelse(total_service_hi_growth > 0, Service_RateHigh * (1+total_service_hi_growth)^30,Service_RateHigh * ( 1 + CAGR_Service)^30),"
"0","         "
"0","         Industry_2030 = Industry * ( 1 + CAGR_Industry)^10,"
"0","         Industry_2040= Industry * ( 1 + CAGR_Industry)^20,"
"0","         Industry_2050= Industry * ( 1 + CAGR_Industry)^30,"
"0","         "
"0","         Office_2030 = ifelse(total_office_growth > 0, Office * (1+total_office_growth)^10,Office * ( 1 + CAGR_Office)^10),"
"0","         Office_2040= ifelse(total_office_growth > 0, Office * (1+total_office_growth)^20,Office * ( 1 + CAGR_Office)^20),"
"0","         Office_2050= ifelse(total_office_growth > 0, Office * (1+total_office_growth)^30,Office * ( 1 + CAGR_Office)^30)"
"0","         "
"0","         ) %>%"
"0","  select(-COUNTY, -CAGR_HH, -CAGR_Pop, -CAGR_Retail, -CAGR_Service, -CAGR_Industry, -CAGR_Office) %>%"
"0","  mutate_if(is.numeric, round)"
"0",""
"0","ex <- final_se_alamance[-1]"
"0",""
"0","lapply(ex, sum, na.rm=T)"
"1","$HH
"
"1","[1]"
"1"," 12393"
"1","
"
"1","
"
"1","$HH_POP
"
"1","[1]"
"1"," 30563"
"1","
"
"1","
"
"1","$Industry
"
"1","[1]"
"1"," 3998"
"1","
"
"1","
"
"1","$Office
"
"1","[1]"
"1"," 1688"
"1","
"
"1","
"
"1","$Service_RateLow
"
"1","[1]"
"1"," 2416"
"1","
"
"1","
"
"1","$Service_RateHigh
"
"1","[1]"
"1"," 402"
"1","
"
"1","
"
"1","$Retail
"
"1","[1]"
"1"," 4366"
"1","
"
"1","
"
"1","$Service
"
"1","[1]"
"1"," 2818"
"1","
"
"1","
"
"1","$total_retail_growth
"
"1","[1]"
"1"," 0"
"1","
"
"1","
"
"1","$total_service_low_growth
"
"1","[1]"
"1"," 0"
"1","
"
"1","
"
"1","$total_service_hi_growth
"
"1","[1]"
"1"," 0"
"1","
"
"1","
"
"1","$total_industry_growth
"
"1","[1]"
"1"," 0"
"1","
"
"1","
"
"1","$total_office_growth
"
"1","[1]"
"1"," 0"
"1","
"
"1","
"
"1","$HH_2030
"
"1","[1]"
"1"," 14117"
"1","
"
"1","
"
"1","$HH_2040
"
"1","[1]"
"1"," 16093"
"1","
"
"1","
"
"1","$HH_2050
"
"1","[1]"
"1"," 18361"
"1","
"
"1","
"
"1","$HH_POP_2030
"
"1","[1]"
"1"," 34492"
"1","
"
"1","
"
"1","$HH_POP_2040
"
"1","[1]"
"1"," 38955"
"1","
"
"1","
"
"1","$HH_POP_2050
"
"1","[1]"
"1"," 44035"
"1","
"
"1","
"
"1","$Retail_2030
"
"1","[1]"
"1"," 5057"
"1","
"
"1","
"
"1","$Retail_2040
"
"1","[1]"
"1"," 6063"
"1","
"
"1","
"
"1","$Retail_2050
"
"1","[1]"
"1"," 7643"
"1","
"
"1","
"
"1","$Service_RateLow2030
"
"1","[1]"
"1"," 3181"
"1","
"
"1","
"
"1","$Service_RateLow2040
"
"1","[1]"
"1"," 4637"
"1","
"
"1","
"
"1","$Service_RateLow2050
"
"1","[1]"
"1"," 7509"
"1","
"
"1","
"
"1","$Service_RateHigh2030
"
"1","[1]"
"1"," 567"
"1","
"
"1","
"
"1","$Service_RateHigh2040
"
"1","[1]"
"1"," 865"
"1","
"
"1","
"
"1","$Service_RateHigh2050
"
"1","[1]"
"1"," 1400"
"1","
"
"1","
"
"1","$Industry_2030
"
"1","[1]"
"1"," 4130"
"1","
"
"1","
"
"1","$Industry_2040
"
"1","[1]"
"1"," 4275"
"1","
"
"1","
"
"1","$Industry_2050
"
"1","[1]"
"1"," 4434"
"1","
"
"1","
"
"1","$Office_2030
"
"1","[1]"
"1"," 1862"
"1","
"
"1","
"
"1","$Office_2040
"
"1","[1]"
"1"," 2093"
"1","
"
"1","
"
"1","$Office_2050
"
"1","[1]"
"1"," 2433"
"1","
"
"1","
"
